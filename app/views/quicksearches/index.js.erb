$('.mapcontainer').html('<%= escape_javascript( gmaps({:last_map => false}) ) %>');

Gmaps.map = new Gmaps4RailsGoogle();
Gmaps.load_map = function() {
    Gmaps.map.initialize();
    Gmaps.map.markers = <%=raw @pins %>;
    Gmaps.map.markers_conf.do_clustering = true;
    Gmaps.map.create_markers();
    Gmaps.map.adjustMapToBounds();
    Gmaps.map.callback = function()  {
    	if (Gmaps.map.markers.length == 1) {
         //only one marker, choose the zoom level you expect
         setTimeout(function() { Gmaps.map.serviceObject.setZoom(5);}, 50);
        }
        else{
         //more than one marker, let's auto_zoom
         Gmaps.map.map_options.auto_zoom = true;
         Gmaps.map.adjustMapToBounds();
        };
      }
};
Gmaps.loadMaps();

$('.table').html('<%= escape_javascript( render "table"  ) %>');